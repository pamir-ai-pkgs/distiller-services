<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Connection Status</title>
    <link
      rel="icon"
      href="{{ url_for('static', filename='images/pamir-logo-01.svg') }}"
    />
    <!-- Allow insecure HTTP requests for local IoT device operation -->
    <meta
      http-equiv="Content-Security-Policy"
      content="
        default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: http: https:;
        connect-src 'self' http: https: ws: wss:;
        img-src 'self' data: blob: http: https:;
        font-src 'self' data: http: https:;
        frame-src 'none';
        object-src 'none'
    "
    />
    <!-- Common styles -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/common.css') }}"
    />
    <!-- Page-specific styles -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/status.css') }}"
    />
  </head>

  <body>
    <div class="container">
      <div class="header">
        <h1>Connection Status</h1>
      </div>

      <div class="content">
        {% if status.connected_to_target %}
        <div class="status-connected">
          <div class="status-code">[CONNECTED]</div>
          <div class="status-title">Successfully Connected</div>
          <div class="status-message">
            Your device is connected to the WiFi network and ready for use.
          </div>
        </div>

        <div class="connection-details">
          <div class="detail-row">
            <span class="detail-label">Network</span>
            <span class="detail-value">{{ status.ssid }}</span>
          </div>
          {% if status.ip_address %}
          <div class="detail-row">
            <span class="detail-label">IP Address</span>
            <span class="detail-value">{{ status.ip_address }}</span>
          </div>
          {% endif %} {% if status.interface %}
          <div class="detail-row">
            <span class="detail-label">Interface</span>
            <span class="detail-value">{{ status.interface }}</span>
          </div>
          {% endif %} {% if status.mdns_url %}
          <div class="detail-row">
            <span class="detail-label">mDNS Address</span>
            <span class="detail-value">{{ status.mdns_url }}</span>
          </div>
          {% endif %}
        </div>

        <div class="instructions">
          <div class="instruction-item">
            <div class="instruction-title">Access your device:</div>
            <div class="instruction-detail">
              {% if status.ip_address %} Use IP: {{ status.ip_address }}:{{
              web_port }} {% elif status.mdns_url %} Use mDNS: {{
              status.mdns_url }} {% else %} Check your router's connected
              devices {% endif %}
            </div>
          </div>
          <div class="instruction-item">
            <div class="instruction-title">Network settings:</div>
            <div class="instruction-detail">
              Your device will remember this network for future connections
            </div>
          </div>
          <div class="instruction-item">
            <div class="instruction-title">Setup complete:</div>
            <div class="instruction-detail">
              You can now close this setup interface and use your device
              normally
            </div>
          </div>
        </div>

        {% elif status.connecting %}
        <div class="status-connecting">
          <div class="status-code">[CONNECTING]</div>
          <div class="status-title">Connection in Progress</div>
          <div class="status-message">
            Your device is connecting to the WiFi network. Please wait...
          </div>
        </div>

        <div class="instructions">
          <div class="instruction-item">
            <div class="instruction-title">What's happening:</div>
            <div class="instruction-detail">
              Device is establishing connection to {{ status.target_ssid or 'the
              network' }}
            </div>
          </div>
          <div class="instruction-item">
            <div class="instruction-title">Please wait:</div>
            <div class="instruction-detail">
              This process may take up to 60 seconds
            </div>
          </div>
          <div class="instruction-item">
            <div class="instruction-title">If connection fails:</div>
            <div class="instruction-detail">
              The device will return to setup mode automatically
            </div>
          </div>
        </div>

        {% elif status.connected_to_hotspot %}
        <div class="status-setup">
          <div class="status-code">[SETUP MODE]</div>
          <div class="status-title">Setup Mode Active</div>
          <div class="status-message">
            Device is in setup mode and ready for WiFi configuration.
          </div>
        </div>

        <div class="instructions">
          <div class="instruction-item">
            <div class="instruction-title">Current mode:</div>
            <div class="instruction-detail">
              Device is broadcasting setup hotspot
            </div>
          </div>
          <div class="instruction-item">
            <div class="instruction-title">To connect:</div>
            <div class="instruction-detail">
              Go to the
              <a href="/" style="color: #000; text-decoration: underline"
                >Setup Page</a
              >
              to configure WiFi
            </div>
          </div>
          <div class="instruction-item">
            <div class="instruction-title">Access info:</div>
            <div class="instruction-detail">
              {% if status.ip_address %} Setup available at: {{
              status.ip_address }}:{{ web_port }} {% endif %}
            </div>
          </div>
        </div>

        {% else %}
        <div class="status-disconnected">
          <div class="status-code">[DISCONNECTED]</div>
          <div class="status-title">Not Connected</div>
          <div class="status-message">
            Device is not connected to any network.
          </div>
        </div>

        <div class="instructions">
          <div class="instruction-item">
            <div class="instruction-title">Status:</div>
            <div class="instruction-detail">
              Device is not connected to WiFi
            </div>
          </div>
          <div class="instruction-item">
            <div class="instruction-title">To connect:</div>
            <div class="instruction-detail">
              Go to the
              <a href="/" style="color: #000; text-decoration: underline"
                >Setup Page</a
              >
              to configure WiFi
            </div>
          </div>
        </div>
        {% endif %}

        <div class="button-group">
          <a href="javascript:location.reload()" class="btn btn-primary"
            >Refresh Status</a
          >
          <a href="/" class="btn btn-secondary">WiFi Setup</a>
        </div>
      </div>

      <div class="footer">
        <div class="footer-content">
          <img
            src="{{ url_for('static', filename='images/pamir-logo-01.svg') }}"
            alt="Pamir AI"
            class="footer-logo"
          />
          <span class="footer-text">{{ device_name }} Network Status</span>
        </div>
      </div>
    </div>

    <!-- Common JavaScript -->
    <script src="{{ url_for('static', filename='js/common.js') }}"></script>
    {% if status.connecting %}
    <script>
      // Auto-refresh during connecting state
      CommonUtils.onReady(function () {
        setTimeout(function () {
          console.log("Auto-refreshing status during connection...");
          window.location.reload();
        }, 5000);
      });
    </script>
    {% endif %}
  </body>
</html>
